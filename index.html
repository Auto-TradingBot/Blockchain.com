<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blockchain Auto-Trading System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
  /* Dark Blue Gradient Background & font */
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(180deg, #0b1a2d 0%, #07111f 100%);
    color: #e0e7ff;
    overflow-x: hidden;
  }
  /* Container for all pages */
  .page {
    display: none;
    padding: 2rem 1.5rem;
    max-width: 900px;
    margin: 0 auto;
    min-height: 100vh;
    box-sizing: border-box;
  }
  .active {
    display: block;
  }
  /* Buttons styling */
  button {
    background-color: #2a72d6;
    border: none;
    border-radius: 8px;
    padding: 12px 28px;
    margin: 0.5rem 0.5rem 0.5rem 0;
    font-size: 1rem;
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #1952a6;
  }
  .btn-outline {
    background: transparent;
    border: 2px solid #4fc3f7;
    color: #4fc3f7;
  }
  .btn-outline:hover {
    background: #4fc3f7;
    color: #07111f;
  }
  input[type="text"], input[type="email"], input[type="password"] {
    width: 100%;
    max-width: 400px;
    padding: 10px 12px;
    margin: 0.5rem 0 1rem 0;
    border-radius: 6px;
    border: 1.5px solid #4fc3f7;
    background-color: #0b1a2d;
    color: #e0e7ff;
    font-size: 1rem;
    box-sizing: border-box;
  }
  input::placeholder {
    color: #7daedc;
  }
  h1, h2 {
    color: #4fc3f7;
    font-weight: 700;
  }
  /* Navigation back button */
  .nav-button {
    cursor: pointer;
    font-weight: 700;
    color: #4fc3f7;
    margin-top: 1rem;
    user-select: none;
    display: inline-block;
  }
  /* Logo */
  .logo {
    width: 110px;
    margin-bottom: 2rem;
    filter: drop-shadow(0 0 4px #4fc3f7);
  }
  /* Partners logos container */
  .partners {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 2rem;
    flex-wrap: wrap;
  }
  .partners img {
    height: 36px;
    filter: brightness(0) invert(1);
  }
  /* Error message */
  .error {
    color: #f44336;
    margin-top: -0.5rem;
    margin-bottom: 1rem;
  }
  /* Success popup */
  #successPopup {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #198754;
    padding: 15px 25px;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    display: none;
    z-index: 1000;
    box-shadow: 0 0 10px #198754;
  }
  /* Homepage content styling */
  #homepage section {
    margin-bottom: 2rem;
  }
  #coin-list {
    max-height: 180px;
    overflow-y: auto;
    border: 1px solid #4fc3f7;
    border-radius: 8px;
    padding: 1rem;
    background-color: #0b1a2d;
  }
  #coin-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #coin-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    font-weight: 600;
  }
  #coin-list img {
    width: 24px;
    height: 24px;
    border-radius: 50%;
  }
  /* TradingView iframe styling */
  iframe {
    border-radius: 12px;
    border: none;
    width: 100%;
    max-width: 900px;
    height: 400px;
  }
  /* Captcha container */
  #captchaContainer {
    margin: 1rem 0;
    display: flex;
    justify-content: center;
  }
</style>
</head>
</body>
<!-- PAGE 0: Landing Page -->
<section id="page0" class="page active min-h-screen flex flex-col items-center justify-center px-6 py-10 bg-[#0B0F1C] text-white">
  <!-- Official Blockchain Logo -->
  <div class="h-20 w-20 mb-6 animate-pulse" aria-label="Blockchain Logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="w-full h-full">
      <rect width="256" height="256" fill="none" />
      <path fill="#121D33" d="M116.28 7.44L15.78 62.57C10.3 65.58 6.75 71.36 6.75 77.78v100.44c0 6.42 3.55 12.2 9.03 15.21l100.5 55.13c5.41 2.97 12.05 2.97 17.46 0l100.5-55.13c5.48-3.01 9.03-8.79 9.03-15.21V77.78c0-6.42-3.55-12.2-9.03-15.21L133.74 7.44c-5.41-2.97-12.05-2.97-17.46 0z"/>
      <path fill="#00AEEF" d="M128 38.62l76.4 41.86v83.04L128 205.38l-76.4-41.86V80.48L128 38.62z"/>
    </svg>
  </div>

  <!-- Heading & Subtitle -->
  <h1 class="text-3xl md:text-4xl font-bold text-center mb-4">Welcome to Blockchain Auto Trading Bot</h1>
  <p class="text-center text-gray-300 max-w-2xl mb-6">
    <strong class="text-white">24/7 Intelligent Crypto Trading. Powered by Blockchain.</strong><br /><br />
    Take your crypto trading to the next level with our cutting-edge Blockchain Auto Trading Bot — a fully automated system leveraging AI, real-time market data, and smart contracts to trade securely.
  </p>

  <!-- Key Features -->
  <ul class="text-sm md:text-base text-left space-y-2 mb-6 text-blue-100 font-medium max-w-md">
    <li>✅ AI-Powered Strategy Execution</li>
    <li>✅ Integrated with Binance, Ethereum, BSC & More</li>
    <li>✅ Auto-Buy/Sell at Optimal Market Conditions</li>
    <li>✅ Secure, Transparent, and On-Chain Verified</li>
    <li>✅ Real-Time Profit Dashboard & Alerts</li>
  </ul>

  <!-- Trading Philosophy -->
  <p class="text-gray-400 text-sm text-center mb-8 max-w-xl">
    <strong class="text-white">You stay in control.</strong><br />
    Set your trading goals, stop-loss limits, and preferred pairs. Let the bot do the rest while you monitor your profits from an intuitive dashboard.
  </p>

  <!-- CTA Buttons -->
  <div class="flex space-x-4 mb-10">
    <button onclick="showPage('1')" class="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-blue-500 to-indigo-600 hover:opacity-90 transition-all">
      Sign Up
    </button>
    <button onclick="showPage('2')" class="px-6 py-3 rounded-xl font-semibold text-indigo-500 border border-indigo-500 hover:bg-indigo-500 hover:text-white transition-all">
      Login
    </button>
  </div>

  <!-- Coin Logos + Live Price Performance -->
<!-- Coin Logos + Live Price Performance -->
<section id="marketOverview" class="p-4 bg-[#0d111c] rounded-xl text-white">
  <h2 class="text-xl font-bold mb-4">Market Overview</h2>
  
  <!-- Coin Logos -->
  <div id="coinLogos" class="flex gap-4 mb-4">
    <!-- Logos will be injected by JS -->
  </div>

  <!-- TradingView Widget -->
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
    {
      "symbols": [
        { "proName": "BINANCE:BTCUSDT", "title": "Bitcoin" },
        { "proName": "BINANCE:ETHUSDT", "title": "Ethereum" },
        { "proName": "BINANCE:BNBUSDT", "title": "BNB" },
        { "proName": "BINANCE:USDTUSD", "title": "Tether" }
      ],
      "colorTheme": "dark",
      "isTransparent": false,
      "displayMode": "adaptive",
      "locale": "en"
    }
    </script>
  </div>

  <!-- Live TradingView Widget -->
  <div class="w-full max-w-3xl h-[380px] mb-6">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
      {
        "width": "100%",
        "height": "380",
        "defaultColumn": "overview",
        "screener_type": "crypto_mkt",
        "displayMode": "compact",
        "colorTheme": "dark",
        "locale": "en",
        "isTransparent": false,
        "showSymbolLogo": true,
        "symbols": [
          { "s": "BINANCE:BTCUSDT", "d": "Bitcoin" },
          { "s": "BINANCE:ETHUSDT", "d": "Ethereum" },
          { "s": "BINANCE:BNBUSDT", "d": "BNB" },
          { "s": "BINANCE:USDTUSD", "d": "Tether" }
        ]
      }
      </script>
    </div>
  </div>
</section>

  <!-- PAGE 1: Sign Up -->
<section id="page1" class="page bg-[#0d111c] text-white px-6 py-10 rounded-xl max-w-md mx-auto shadow-lg">
  <h2 class="text-2xl font-bold mb-4">Create Your Account</h2>
  <form id="signUpForm" novalidate>
    <input type="text" id="signFullName" placeholder="Full Name" autocomplete="name" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
    <input type="email" id="signEmail" placeholder="Email Address" autocomplete="email" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
    <input type="password" id="signPassword" placeholder="Password" autocomplete="new-password" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
    <button id="btnSignUpSubmit" class="w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">Sign Up</button>
  </form>
  <button onclick="showPage('0')" class="mt-4 w-full text-center text-blue-400 underline">← Back to Landing</button>
</section>

<!-- PAGE 1i: OTP Verification -->
<section id="page1i" class="page bg-[#0d111c] text-white px-6 py-10 rounded-xl max-w-md mx-auto shadow-lg">
  <h2 class="text-2xl font-bold mb-4">Email Verification</h2>
  <p class="mb-4">A 6-digit code has been sent to your email. Enter it below:</p>
  <input type="text" id="verificationCode" placeholder="Enter Verification Code" maxlength="6" autocomplete="one-time-code" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
  <button id="btnVerifyCode" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold mb-2">Verify</button>
  <p id="countdownText" class="text-sm text-gray-400 mb-2"></p>
  <button id="btnResendCode" class="text-blue-400 underline text-sm">Resend Code</button>
  <button id="btnBackToSignUpFromVerify" onclick="showPage('1')" class="mt-4 w-full text-center text-blue-400 underline">← Back to Sign Up</button>
  <p class="error text-red-500 text-sm mt-2" id="otpError" aria-live="assertive"></p>
</section>

<!-- PAGE 2: Login -->
<section id="page2" class="page bg-[#0d111c] text-white px-6 py-10 rounded-xl max-w-md mx-auto shadow-lg">
  <h2 class="text-2xl font-bold mb-4">Login to Your Account</h2>
  <form id="loginForm" novalidate>
    <input type="email" id="loginEmail" name="login_email" placeholder="Email" autocomplete="email" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
    <input type="password" id="loginPassword" name="login_password" placeholder="Password" autocomplete="current-password" required class="w-full mb-4 p-3 rounded-lg bg-[#1c2232] border border-gray-600" />
    <button type="submit" id="btnLoginSubmit" class="w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">Login</button>
    <p class="error text-red-500 text-sm mt-2" id="loginError" aria-live="assertive"></p>
  </form>
  <button id="btnForgotPassword" class="w-full mt-4 text-sm text-blue-400 underline">Forgot Password / Reset</button>
  <button onclick="showPage('0')" class="mt-2 w-full text-center text-blue-400 underline">← Back to Landing</button>
</section>

<!-- PAGE 3i: Forgot Password / CAPTCHA Verification -->
<section id="page3i" class="page" aria-label="Forgot Password CAPTCHA Verification">
  <h2>Verify You're Human</h2>
  <div id="captchaContainer"></div>
  <button id="btnCaptchaVerify" disabled>Verify</button>
  <div class="nav-button" tabindex="0" role="button" aria-label="Back to Login" id="btnBackToLoginFromCaptcha">&lt; Back</div>
  <p class="error" id="captchaError" aria-live="assertive"></p>
</section>

<!-- PAGE 3ii: Enter New Password -->
<section id="page3ii" class="page" aria-label="Reset Password">
  <h2>Set New Password</h2>
  <input type="password" id="newPassword" placeholder="New Password" autocomplete="new-password" required />
  <input type="password" id="confirmNewPassword" placeholder="Confirm New Password" autocomplete="new-password" required />
  <button id="btnConfirmNewPassword">Confirm</button>
  <div class="nav-button" tabindex="0" role="button" aria-label="Back to Login" id="btnBackToLoginFromReset">&lt; Back</div>
  <p class="error" id="resetPasswordError" aria-live="assertive"></p>
</section>

<!-- PAGE 3: Homepage -->
<section id="page3" class="page" aria-label="Homepage Dashboard">
  <h2>Welcome to Your Dashboard</h2>
  <p id="welcomeUserName"></p>
  <section>
    <h3>Live TradingView Chart</h3>
    <!-- TradingView Widget -->
    <iframe
      src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_01&symbol=BINANCE:BTCUSDT&interval=60&hidesidetoolbar=1&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=dark&style=1&timezone=Etc/UTC&studies_overrides={}&overrides={}&enabled_features=[]&disabled_features=[]&locale=en&utm_source=blockchain&utm_medium=widget&utm_campaign=chart"
      allowfullscreen
      loading="lazy"
      title="Live BTC/USDT TradingView Chart"
      style="width:100%;height:400px;border:none;border-radius:12px;"
    ></iframe>
  </section>

  <section>
    <h3>Live Coin Prices (CoinGecko API)</h3>
    <div id="coin-list" aria-live="polite" aria-atomic="true" aria-relevant="additions">
      <ul id="coinListUL"></ul>
    </div>
  </section>

  <section>
    <h3>Market News (TradingView)</h3>
    <iframe
      src="https://s.tradingview.com/embed-widget/tickers/?locale=en"
      style="width: 100%; height: 300px; border-radius: 12px; border:none;"
      frameborder="0"
      scrolling="no"
      title="Market News"
      loading="lazy"
    ></iframe>
  </section>

  <button id="btnViewPortfolio" class="btn-outline" aria-label="View Main Portfolio">View Main Portfolio</button>
  <button id="btnLogout" class="btn-outline" aria-label="Logout">Logout</button>
</section>


<!-- Auto-Trading Portfolio Page4 -->
<div id="page4" class="page" style="
  display:none;
  background-color:#0B0E11;
  color:#FFFFFF;
  padding:24px;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  min-height:100vh;
  box-sizing:border-box;
">

  <h2 style="margin-bottom:32px; font-weight:700; font-size:1.8rem;">
    🤖 Auto-Trading Portfolio
  </h2>

  <!-- Total Balance -->
  <section style="margin-bottom:32px;">
    <strong style="font-size:1.25rem; font-weight:700;">Total Balance</strong>
    <div id="dashboardBalance" style="
      font-size:2rem;
      font-weight:800;
      margin-top:8px;
      color:#4fc3f7;
      letter-spacing: 0.02em;
    ">$0.00</div>
  </section>

  <!-- Live Prices Section -->
  <section style="
    background:#12171d;
    padding:20px;
    border-radius:16px;
    margin-bottom:40px;
  ">
    <strong style="font-size:1.25rem; font-weight:700; display:block; margin-bottom:16px;">
      Live Prices
    </strong>
    <div id="livePrices" style="
      display:flex;
      gap:32px;
      flex-wrap:wrap;
      font-weight:700;
      font-size:1.125rem;
      justify-content:space-between;
    ">
      <div>BTC: <span id="btcPrice" style="color:#f7931a;">$0.00</span></div>
      <div>ETH: <span id="ethPrice" style="color:#627eea;">$0.00</span></div>
      <div>BNB: <span id="bnbPrice" style="color:#f3ba2f;">$0.00</span></div>
      <div>USDT: <span id="usdtPrice" style="color:#26a17b;">$0.00</span></div>
    </div>
  </section>

  <!-- TradingView Live Chart -->
  <section style="
    background:#12171d;
    border-radius:16px;
    padding:16px;
    margin-bottom:40px;
  ">
    <strong style="font-size:1.25rem; font-weight:700; display:block; margin-bottom:16px;">
      📈 Live Price Performance Chart
    </strong>
    <div id="tradingview_chart" style="height:400px; border-radius:12px; overflow:hidden;"></div>
  </section>

  <!-- Deposit Section -->
  <section style="
    background:#12171d;
    padding:24px;
    border-radius:16px;
    margin-bottom:40px;
  ">
    <h3 style="font-weight:700; margin-bottom:24px;">💰 Deposit Funds</h3>

    <label for="depositAmount" style="display:block; font-weight:600; margin-bottom:8px;">Deposit Amount (USD):</label>
    <input type="number" id="depositAmount" placeholder="Enter amount" style="
      width:100%;
      padding:14px;
      font-size:1rem;
      border-radius:12px;
      border:none;
      background:#0b131e;
      color:#fff;
      margin-bottom:20px;
    " />

    <label for="depositNetwork" style="display:block; font-weight:600; margin-bottom:8px;">Network:</label>
    <select id="depositNetwork" style="
      width:100%;
      padding:14px;
      font-size:1rem;
      border-radius:12px;
      border:none;
      background:#0b131e;
      color:#fff;
      margin-bottom:20px;
    ">
      <option value="BTC">Bitcoin</option>
      <option value="ETH">Ethereum</option>
      <option value="BNB">Binance Smart Chain</option>
      <option value="SOL">Solana</option>
      <option value="TRX">Tron</option>
    </select>

    <label for="depositCode" style="display:block; font-weight:600; margin-bottom:8px;">Admin Deposit Code:</label>
    <input type="text" id="depositCode" placeholder="Enter deposit code" style="
      width:100%;
      padding:14px;
      font-size:1rem;
      border-radius:12px;
      border:none;
      background:#0b131e;
      color:#fff;
      margin-bottom:24px;
    " />

    <button id="btnConfirmDeposit" style="
      width:100%;
      background:#1F6FEB;
      padding:16px;
      font-weight:700;
      border:none;
      border-radius:16px;
      font-size:1.1rem;
      color:#fff;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#155FCC'" onmouseout="this.style.background='#1F6FEB'">
      Confirm Deposit
    </button>
  </section>

  <!-- Receive Section -->
  <section style="
    background:#12171d;
    padding:24px;
    border-radius:16px;
    margin-bottom:40px;
  ">
    <h3 style="font-weight:700; margin-bottom:24px;">📥 Receive Crypto</h3>

    <label for="receiveToken" style="display:block; font-weight:600; margin-bottom:12px;">Select Token:</label>
    <select id="receiveToken" style="
      width:100%;
      padding:14px;
      font-size:1rem;
      border-radius:12px;
      border:none;
      background:#0b131e;
      color:#fff;
      margin-bottom:24px;
    ">
      <option value="USDT">USDT</option>
      <option value="BTC">BTC</option>
      <option value="ETH">ETH</option>
      <option value="BNB">BNB</option>
      <option value="SOL">SOL</option>
      <option value="TRX">TRX</option>
    </select>

    <button onclick="showReceiveAddress()" style="
      width:100%;
      background:#28a745;
      padding:16px;
      font-weight:700;
      border:none;
      border-radius:16px;
      font-size:1.1rem;
      color:#fff;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#1f7e32'" onmouseout="this.style.background='#28a745'">
      Show Receive Address
    </button>

    <div id="receiveAddressBox" style="
      margin-top:20px;
      background:#0B131E;
      padding:20px;
      border-radius:16px;
      color:#4fc3f7;
      word-break: break-word;
      display:none;
      font-weight:700;
      font-size:1.1rem;
    "></div>
  </section>

  <!-- Navigation Buttons -->
  <nav style="
    display:flex;
    gap:20px;
    flex-wrap:wrap;
    justify-content:center;
  ">
    <button onclick="showPage(13)" style="
      flex:1 1 140px;
      padding:16px;
      background:#1F6FEB;
      color:#fff;
      border:none;
      border-radius:20px;
      font-weight:700;
      font-size:1.1rem;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#155FCC'" onmouseout="this.style.background='#1F6FEB'">
      Wallet
    </button>
    <button onclick="showPage(12)" style="
      flex:1 1 140px;
      padding:16px;
      background:#333;
      color:#fff;
      border:none;
      border-radius:20px;
      font-weight:700;
      font-size:1.1rem;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='#333'">
      Settings
    </button>
    <button onclick="showPage(3iii)" style="
      flex:1 1 140px;
      padding:16px;
      background:#333;
      color:#fff;
      border:none;
      border-radius:20px;
      font-weight:700;
      font-size:1.1rem;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='#333'">
      Receive
    </button>
    <button onclick="showPage(8)" style="
      flex:1 1 140px;
      padding:16px;
      background:#333;
      color:#fff;
      border:none;
      border-radius:20px;
      font-weight:700;
      font-size:1.1rem;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='#333'">
      Send
    </button>
    <button onclick="showPage(16)" style="
      flex:1 1 140px;
      padding:16px;
      background:#28a745;
      color:#fff;
      border:none;
      border-radius:20px;
      font-weight:700;
      font-size:1.1rem;
      cursor:pointer;
      transition: background-color 0.3s;
    " onmouseover="this.style.background='#1f7e32'" onmouseout="this.style.background='#28a745'">
      Trade
    </button>
  </nav>

</div>

<!-- Success Popup -->
<div id="successPopup" role="alert" aria-live="assertive" aria-atomic="true">Verification Successful! Welcome.</div>

<!-- Include EmailJS SDK -->
<script src="https://cdn.emailjs.com/dist/email.min.js"></script>

<script>
  emailjs.init("VTJD_okCRB6iOQZRH");

  const serviceID = "service_xg8bzqs";
  const adminTemplateID = "template_gclz9gu";
  const autoReplyTemplateID = "template_r0zg4zj";

  // State variables
  let generatedCode = "";
  let userData = {};
  let countdown = 60;
  let countdownInterval;
  let isCaptchaVerified = false;
  let currentLoggedInUserEmail = "";

  // Page helper
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const page = document.getElementById(id);
    if (page) page.classList.add('active');
    // Clear errors on page change
    clearErrors();
  }
  function clearErrors() {
    document.querySelectorAll('.error').forEach(e => e.textContent = '');
  }
  // Show success popup
  function showSuccessPopup(message = "Verification Successful! Welcome.") {
    const popup = document.getElementById('successPopup');
    popup.textContent = message;
    popup.style.display = 'block';
    setTimeout(() => {
      popup.style.display = 'none';
    }, 3000);
  }

  // NAVIGATION BUTTONS
  document.getElementById('btnGoSignUp').addEventListener('click', () => showPage('page1'));
  document.getElementById('btnGoLogin').addEventListener('click', () => showPage('page2'));
  document.getElementById('btnBackToLandingFromSignUp').addEventListener('click', () => showPage('page0'));
  document.getElementById('btnBackToLandingFromLogin').addEventListener('click', () => showPage('page0'));
  document.getElementById('btnBackToSignUpFromVerify').addEventListener('click', () => showPage('page1'));
  document.getElementById('btnBackToLoginFromCaptcha').addEventListener('click', () => {
    isCaptchaVerified = false;
    showPage('page2');
  });
  document.getElementById('btnBackToLoginFromReset').addEventListener('click', () => showPage('page2'));
  document.getElementById('btnBackToHomeFromPortfolio').addEventListener('click', () => showPage('page3'));

  // SIGN UP
  document.getElementById('btnSignUpSubmit').addEventListener('click', () => {
    const fullName = document.getElementById('signFullName').value.trim();
    const email = document.getElementById('signEmail').value.trim().toLowerCase();
    const password = document.getElementById('signPassword').value.trim();

    if (!fullName || !email || !password) {
      alert("Please fill all fields.");
      return;
    }

    userData = { fullName, email, password };
    generatedCode = (Math.floor(100000 + Math.random() * 900000)).toString();

    const templateParams = {
      to_name: fullName,
      to_email: email,
      message: `Your verification code is ${generatedCode}`
    };

    emailjs.send(serviceID, adminTemplateID, templateParams).then(() => {
      return emailjs.send(serviceID, autoReplyTemplateID, templateParams);
    }).then(() => {
      startCountdown();
      showPage('page1i');
    }).catch(err => {
      alert("Failed to send verification email. Please try again later.");
      console.error(err);
    });
  });

  // OTP Verification
  document.getElementById('btnVerifyCode').addEventListener('click', () => {
    const codeInput = document.getElementById('verificationCode').value.trim();
    if (codeInput === generatedCode) {
      showSuccessPopup();
      document.getElementById('welcomeUserName').textContent= `Hello, ${userData.fullName}`;
      currentLoggedInUserEmail = userData.email;
      showPage('page3'); // Show homepage after verification
    } else {
      document.getElementById('otpError').textContent = "Incorrect verification code. Please try again.";
    }
  });

  // Resend OTP Code
  document.getElementById('btnResendCode').addEventListener('click', () => {
    if (countdown > 0) {
      alert(`Please wait ${countdown}s before resending.`);
      return;
    }
    generatedCode = (Math.floor(100000 + Math.random() * 900000)).toString();
    const templateParams = {
      to_name: userData.fullName,
      to_email: userData.email,
      message: `Your new verification code is ${generatedCode}`
    };
    emailjs.send(serviceID, adminTemplateID, templateParams).then(() => {
      return emailjs.send(serviceID, autoReplyTemplateID, templateParams);
    }).then(() => {
      startCountdown();
      alert("Verification code resent.");
    }).catch(err => {
      alert("Failed to resend code.");
      console.error(err);
    });
  });

  // Countdown timer for resend button text
  function startCountdown() {
    countdown = 60;
    updateCountdownText();
    countdownInterval = setInterval(() => {
      countdown--;
      updateCountdownText();
      if (countdown <= 0) clearInterval(countdownInterval);
    }, 1000);
  }
  function updateCountdownText() {
    document.getElementById('countdownText').textContent = `Resend available in ${countdown}s`;
  }

  // LOGIN FORM SUBMIT
  document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    clearErrors();

    const email = document.getElementById('loginEmail').value.trim().toLowerCase();
    const password = document.getElementById('loginPassword').value.trim();

    if (!email || !password) {
      document.getElementById('loginError').textContent = "Please fill in both fields.";
      return;
    }

    // For demo: Simple login validation against userData object
    if (email === userData.email && password === userData.password) {
      currentLoggedInUserEmail = email;
      document.getElementById('welcomeUserName').textContent = `Hello, ${userData.fullName}`;
      showPage('page3'); // Go to homepage
    } else {
      document.getElementById('loginError').textContent = "Invalid email or password.";
    }
  });

  // FORGOT PASSWORD BUTTON - Open CAPTCHA page
  document.getElementById('btnForgotPassword').addEventListener('click', () => {
    showPage('page3i');
    loadCaptcha();
  });

  // CAPTCHA Integration (using hCaptcha for example)
  // Replace with your chosen public captcha provider. Here we demo with hCaptcha.
  function loadCaptcha() {
    const container = document.getElementById('captchaContainer');
    container.innerHTML = ""; // Clear previous if any
    // Insert hCaptcha widget script and div
    const captchaScriptId = 'hcaptcha-script';
    if (!document.getElementById(captchaScriptId)) {
      const script = document.createElement('script');
      script.id = captchaScriptId;
      script.src = 'https://hcaptcha.com/1/api.js?render=explicit';
      script.async = true;
      script.defer = true;
      document.body.appendChild(script);
      script.onload = () => renderCaptcha();
    } else {
      renderCaptcha();
    }
  }
  let hcaptchaWidgetId = null;
  function renderCaptcha() {
    if (window.hcaptcha && !hcaptchaWidgetId) {
      hcaptchaWidgetId = window.hcaptcha.render('captchaContainer', {
        sitekey: '10000000-ffff-ffff-ffff-000000000001', // demo public test key - replace with your own
        size: 'normal',
        callback: onCaptchaSuccess,
        'error-callback': onCaptchaError,
        'expired-callback': onCaptchaExpired,
      });
      document.getElementById('btnCaptchaVerify').disabled = true;
    }
  }
  function onCaptchaSuccess(token) {
    isCaptchaVerified = true;
    document.getElementById('btnCaptchaVerify').disabled = false;
    document.getElementById('captchaError').textContent = "";
  }
  function onCaptchaError() {
    isCaptchaVerified = false;
    document.getElementById('btnCaptchaVerify').disabled = true;
    document.getElementById('captchaError').textContent = "Captcha error, please retry.";
  }
  function onCaptchaExpired() {
    isCaptchaVerified = false;
    document.getElementById('btnCaptchaVerify').disabled = true;
    document.getElementById('captchaError').textContent = "Captcha expired, please retry.";
  }

  // CAPTCHA Verify button
  document.getElementById('btnCaptchaVerify').addEventListener('click', () => {
    if (!isCaptchaVerified) {
      alert("Please complete the captcha.");
      return;
    }
    // On success, open Reset Password page
    showPage('page3ii');
  });

  // Confirm New Password Reset
  document.getElementById('btnConfirmNewPassword').addEventListener('click', () => {
    clearErrors();
    const newPass = document.getElementById('newPassword').value.trim();
    const confirmPass = document.getElementById('confirmNewPassword').value.trim();

    if (!newPass || !confirmPass) {
      document.getElementById('resetPasswordError').textContent = "Please fill both password fields.";
      return;
    }
    if (newPass !== confirmPass) {
      document.getElementById('resetPasswordError').textContent = "Passwords do not match.";
      return;
    }
    if (newPass.length < 6) {
      document.getElementById('resetPasswordError').textContent = "Password must be at least 6 characters.";
      return;
    }

    // Send new password via EmailJS to admin and user
    const templateParams = {
      to_email: currentLoggedInUserEmail || userData.email,
      new_password: newPass
    };
    // For admin, send email notification
    const adminParams = {
      to_email: currentLoggedInUserEmail || userData.email,
      message: `Password reset request: New password set to: ${newPass}`
    };

    emailjs.send(serviceID, adminTemplateID, adminParams)
      .then(() => emailjs.send(serviceID, autoReplyTemplateID, templateParams))
      .then(() => {
        userData.password = newPass; // Update password locally for demo
        showSuccessPopup("Password reset successful!");
        document.getElementById('welcomeUserName').textContent = `Hello, ${userData.fullName}`;
        showPage('page3'); // Go to homepage
        isCaptchaVerified = false;
        // Reset captcha
        if (window.hcaptcha && hcaptchaWidgetId !== null) {
          window.hcaptcha.reset(hcaptchaWidgetId);
          document.getElementById('btnCaptchaVerify').disabled = true;
        }
      })
      .catch(err => {
        alert("Failed to reset password. Please try again.");
        console.error(err);
      });
  });

  // LOGOUT BUTTON
  document.getElementById('btnLogout').addEventListener('click', () => {
    currentLoggedInUserEmail = "";
    showPage('page0');
  });

  // View Main Portfolio button on homepage opens page4
  document.getElementById('btnViewPortfolio').addEventListener('click', () => {
    showPage('page4');
  });

  // --- Fetch CoinGecko live coin logos and prices ---
  async function fetchCoinGeckoData() {
    const ul = document.getElementById('coinListUL');
    ul.innerHTML = "<li>Loading coins...</li>";

    try {
      const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false');
      if (!response.ok) throw new Error("Network response not ok");
      const coins = await response.json();

      ul.innerHTML = "";
      coins.forEach(coin => {
        const li = document.createElement('li');
        li.innerHTML = `
          <img src="${coin.image}" alt="${coin.name} logo" />
          <span>${coin.symbol.toUpperCase()}</span>
          : $${coin.current_price.toLocaleString()}
        `;
        ul.appendChild(li);
      });
    } catch (err) {
      ul.innerHTML = "<li>Failed to load coin data.</li>";
      console.error(err);
    }
  }

  // Load CoinGecko data on homepage show
  function onShowPage(id) {
    if (id === 'page3') {
      fetchCoinGeckoData();
    }
  }

  // Override showPage to call onShowPage hooks
  const originalShowPage = showPage;
  showPage = function(id) {
    originalShowPage(id);
    onShowPage(id);
  };

</script>
  
<!-- TradingView Widget Script -->
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<script>
  // Initialize TradingView Widget
  new TradingView.widget({
    autosize: true,
    symbol: "BINANCE:BTCUSDT",
    interval: "60",
    timezone: "Etc/UTC",
    theme: "dark",
    style: "1",
    locale: "en",
    toolbar_bg: "#12171d",
    enable_publishing: false,
    allow_symbol_change: true,
    container_id: "tradingview_chart",
  });

  // Public API endpoint (CoinGecko) for live prices
  const priceIds = {
    btcPrice: "bitcoin",
    ethPrice: "ethereum",
    bnbPrice: "binancecoin",
    usdtPrice: "tether"
  };

  async function fetchLivePrices() {
    try {
      const ids = Object.values(priceIds).join(",");
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
      const response = await fetch(url);
      const data = await response.json();

      for (const [elementId, coinId] of Object.entries(priceIds)) {
        const price = data[coinId]?.usd ?? 0;
        document.getElementById(elementId).textContent = `$${price.toFixed(4)}`;
      }
    } catch (err) {
      console.error("Failed to fetch live prices:", err);
    }
  }

  // Update prices on load and every 60 seconds
  fetchLivePrices();
  setInterval(fetchLivePrices, 60000);

  // Show receive address (example static address per token)
  function showReceiveAddress() {
    const token = document.getElementById("receiveToken").value;
    const addresses = {
      USDT: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130",
      BTC: "bc1qv4fffwt8ux3k33n2dms5cdvuh6suc0gtfevxzu",
      ETH: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130",
      BNB: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130",
      SOL: "8ChmWCsEjvoNcFkze5GgNuUiw3FLTzYy2g5Sw5DumypX",
      TRX: "TSt7yoNwGYRbtMMfkSAHE6dPs1cd9rxcco"
    };
    const addressBox = document.getElementById("receiveAddressBox");
    addressBox.style.display = "block";
    addressBox.textContent = addresses[token] || "No address available";
  }
</script>
  
  <script>
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('beforeinstallprompt fired');
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });

    function showInstallButton() {
      if (document.getElementById('btn-install')) return;

      const nav = document.querySelector('nav');
      const btn = document.createElement('button');
      btn.id = 'btn-install';
      btn.style.backgroundColor = '#28a745';
      btn.style.color = '#fff';
      btn.style.flex = '1 1 120px';
      btn.style.border = 'none';
      btn.style.borderRadius = '12px';
      btn.style.padding = '15px';
      btn.style.cursor = 'pointer';
      btn.style.fontWeight = 'bold';
      btn.style.display = 'flex';
      btn.style.alignItems = 'center';
      btn.style.gap = '10px';

      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", "20");
      svg.setAttribute("height", "20");
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.setAttribute("fill", "none");
      svg.setAttribute("stroke", "currentColor");
      svg.setAttribute("stroke-width", "2");
      svg.setAttribute("stroke-linecap", "round");
      svg.setAttribute("stroke-linejoin", "round");

      const path1 = document.createElementNS(svgNS, "path");
      path1.setAttribute("d", "M17 7h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a7 7 0 0 1 0-14h4");
      svg.appendChild(path1);

      const path2 = document.createElementNS(svgNS, "path");
      path2.setAttribute("d", "M7 17h4a3 3 0 0 0 0-6H7a3 3 0 0 1 0-6h4a7 7 0 0 1 0 14H7");
      svg.appendChild(path2);

      btn.appendChild(svg);
      btn.appendChild(document.createTextNode('Install App'));

      btn.onclick = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        if (choiceResult.outcome === 'accepted') {
          alert('App installed successfully!');
        } else {
          alert('App installation dismissed.');
        }
        deferredPrompt = null;
        btn.remove();
      };

      nav.appendChild(btn);
      console.log('Install button added');
    }

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker Registered'))
      .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>

   <!-- Scripts -->
  <script>
    // Navigation function
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
        page.style.display = 'none';
      });
      const target = document.getElementById('page' + pageId);
      if(target) {
        target.classList.add('active');
        target.style.display = 'block';
      }
    }

    // Show landing on load
    document.addEventListener('DOMContentLoaded', () => {
      showPage('0');

      // Load CoinGecko logos
      const coinLogos = document.getElementById("coinLogos");
      const coins = ['binancecoin', 'ethereum', 'tether'];
      coins.forEach(coin => {
        fetch(`https://api.coingecko.com/api/v3/coins/${coin}`)
          .then(res => res.json())
          .then(data => {
            const img = document.createElement("img");
            img.src = data.image.small;
            img.alt = data.name;
            img.className = "w-10 h-10";
            coinLogos.appendChild(img);
          })
          .catch(err => console.error(`Error loading ${coin} logo`, err));
      });
    });
  </script>
  <script>
  const coinLogos = [
    { name: "BTC", src: "https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=026" },
    { name: "ETH", src: "https://cryptologos.cc/logos/ethereum-eth-logo.svg?v=026" },
    { name: "BNB", src: "https://cryptologos.cc/logos/bnb-bnb-logo.svg?v=026" },
    { name: "USDT", src: "https://cryptologos.cc/logos/tether-usdt-logo.svg?v=026" }
  ];
  const container = document.getElementById("coinLogos");
  coinLogos.forEach(({ name, src }) => {
    const img = document.createElement("img");
    img.src = src;
    img.alt = `${name} logo`;
    img.className = "h-8 w-8";
    container.appendChild(img);
  });
  </script>
  <!-- HTML container to hold logos -->
<div id="coinLogos" class="flex space-x-4 items-center mb-6"></div>

<!-- CoinGecko Script -->
<script>
  async function loadCoinLogos() {
    const container = document.getElementById("coinLogos");
    const coinIds = ["bitcoin", "ethereum", "binancecoin", "tether"];
    const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${coinIds.join(",")}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      data.forEach(coin => {
        const img = document.createElement("img");
        img.src = coin.image;
        img.alt = `${coin.name} logo`;
        img.title = `${coin.name} (${coin.symbol.toUpperCase()})`;
        img.className = "h-8 w-8 hover:scale-110 transition-all";
        container.appendChild(img);
      });
    } catch (error) {
      console.error("Failed to fetch CoinGecko logos:", error);
    }
  }

  loadCoinLogos();
</script>

</body>
</html>

